obj-m =
obj-m += MioSoC.o


ifeq ($(KERNEL_PATH),)
$(error please set KERNEL_PATH for kernel compile)
endif

all:check_env MioSoC.ko sigsoc

MioSoC.ko:MioSoC.c MioSoC.h
	make -C ${KERNEL_PATH} M=${PWD} modules


check_env:
	sh ./gbkutf.sh .

sigsoc:main.o
	gcc -Wall -o $@ $^

main.o:main.c
	gcc -Wall -c $< -o $@

clean:
	make -C ${KERNEL_PATH} M=${PWD} clean
	rm -f main.o sigsoc
	# to remove the backup files
	rm -f *~ *.gbk.c *.gbk.h